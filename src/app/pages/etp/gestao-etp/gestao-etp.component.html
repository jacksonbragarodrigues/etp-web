<div class="container-main">
  <!-- Filtros -->
  <div class="header-default">
    <form [formGroup]="gestaoETPFiltroForm">
      <div
        class="row m-0 d-flex w-100 align-middle py-2 listagem-guias-pesquisa"
        style="background-color: #004164; align-items: center; margin-left: 1px"
      >
        <div class="col-sm-12 callout t-18 text-center">
          <span class="font-title">Elaboração de ETP</span>
        </div>
      </div>
      <div class="form-group">
        <div class="row row-form m-12">
          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="descricaoFullText">Pesquisa Textual</label>
            <app-input-search-form
              (keydown.enter)="gestaoBase.onEnter($event)"
              (onClick)="tableLazyLoading()"
              (onSearchKeyEnter)="emitFullText(true)"
              [(showForm)]="toggleForm"
              [(textSearch)]="descricao"
              [placeholderInput]="'Pesquisar por texto'"
              style="width: 100%;"
            >
              <div class="input-group">
                <div
                  *ngFor="let option of optionsTipoPesquisa; let i = index"
                  class="custom-option"
                >
                  <input
                    class="custom-option"
                    id="optionPesquisa{{ i }}"
                    type="radio"
                    [value]="option.value"
                    [(ngModel)]="selectedTipoPesquisa"
                    name="rarioPesquisa"
                    [ngModelOptions]="{ standalone: true }"
                  />
                  <label
                    [for]="'optionPesquisa' + i"
                    class="custom-option-right"
                  >
                    {{ option.label }}
                  </label>
                </div>
              </div>
            </app-input-search-form>
          </div>

          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="tipoLicitacao">Tipo de Contratação</label>
            <p-dropdown
              [style]="{ width: '100%' }"
              id="tipoLicitacao"
              formControlName="tipoLicitacaoEtp"
              [options]="etpTipoLicitacaoList"
              optionLabel="descricao"
              placeholder="Selecione um tipo de contratação"
              filterBy="descricao"
              [filter]="true"
            />
          </div>

          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="situacao">Situação</label>
            <p-multiSelect
              [style]="{ width: '100%' }"
              id="situacao"
              formControlName="situacaoEtp"
              [options]="situacaoList"
              [dataKey]="'id'"
              optionLabel="descricao"
              placeholder="Selecione uma situação"
              filterBy="descricao"
              [filter]="true"
              display="chip"
            />
          </div>

          <div class="col-sm-12 col-md-2 col-lg-2 col-xl-2 botoes">
            <button
              (click)="tableLazyLoading()"
              type="button"
              class="btn btn-secondary btn-info btn-size w-100"
              style="color: white"
            >
              <em
                _ngcontent-cfm-c345=""
                class="fas fa-search float-center icons-btn icons-btn"
              ></em
              >Pesquisar
            </button>
          </div>
        </div>
        <div class="row row-form m-12">
          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="processoSei">Número do Processo SEI</label>
            <input style="min-height: 43px;"
                   (keydown.enter)="gestaoBase.onEnter($event); tableLazyLoading()"
                   formControlName="processoSei"
                   type="text"
                   id="processoSei"
                   placeholder="999999/2025"
                   class="form-control"
                   (blur)="completaNumeroProcessoSei($event, 'processoSei')"
            />
          </div>
          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="numeroEtp">Número do ETP</label>
            <input style="min-height: 43px;"
                   (keydown.enter)="gestaoBase.onEnter($event); tableLazyLoading()"
                   formControlName="numeroEtp"
                   type="text"
                   id="numeroEtp"
                   placeholder="9999/2025"
                   class="form-control"
                   (blur)="completaNumeroEtp($event, 'numeroEtp')"
            />
          </div>

          <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
            <label for="etpEtapa">Etapa</label>
            <p-multiSelect
              [style]="{ width: '100%' }"
              id="etpEtapa"
              formControlName="etpEtapa"
              [options]="etapaList"
              optionLabel="descricao"
              placeholder="Selecione uma Etapa"
              filterBy="descricao"
              [filter]="true"
              display="chip"
            />
          </div>

          <div class="col-sm-12 col-md-2 col-lg-2 col-xl-2 botoes">
            <button
              (click)="limparCampos()"
              type="button"
              class="btn btn-secondary btn-size w-100"
              style="margin-bottom: 0"
            >
              <em
                _ngcontent-cfm-c345=""
                class="fas fa-eraser float-center icons-btn icons-btn"
              ></em
              >Limpar
            </button>
          </div>
        </div>
        <p-accordion (activeIndexChange)="limparFiltrosAvancados($event)">
          <p-accordionTab [header]="'Filtros avançados'">
            <p class="m-0"></p>
            <div class="row row-form m-12">
              <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
                <label for="unidade">Unidade</label>
                <p-multiSelect
                  [style]="{ width: '100%' }"
                  id="unidade"
                  formControlName="unidadeId"
                  [options]="unidadesList"
                  [dataKey]="'id'"
                  optionLabel="descricao"
                  placeholder="Selecione uma unidade"
                  filterBy="sigla,descricao"
                  [filter]="true"
                ><ng-template let-unidade pTemplate="item">
                  <div class="flex align-items-center gap-2">
                    <div>{{ unidade.sigla }} - {{ unidade.descricao }}</div>
                  </div>
                </ng-template>
                </p-multiSelect>
              </div>

              <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
                <label for="servidor">Servidor</label>
                <p-dropdown
                  [style]="{ width: '100%' }"
                  id="servidor"
                  formControlName="servidor"
                  [options]="servidoresList"
                  optionLabel="nome"
                  placeholder="Selecione um servidor"
                  [filter]="true"
                  [filterFields]="['matricula', 'nome', 'siglaUnidade']"
                >
                  <ng-template let-servidor pTemplate="item">
                    <div class="flex align-items-center gap-2">
                      <div>
                        {{ servidor.matricula }} - {{ servidor.nome }} -
                        {{ servidor.siglaUnidade }}
                      </div>
                    </div>
                  </ng-template>
                </p-dropdown>
              </div>



              <!-- <div class="row row-form m-12"> -->
              <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
                <label for="dataRegistroInicial">Data de Registro Inicial</label>
                <input
                  type="date"
                  id="dataRegistroInicial"
                  class="form-control"
                  formControlName="dataRegistroInicial"
                  style="height: 43px"
                />
              </div>

              <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3">
                <label for="dataRegistroFinal">Data de Registro Final</label>
                <input
                  type="date"
                  id="dataRegistroFinal"
                  class="form-control"
                  formControlName="dataRegistroFinal"
                  style="height: 43px"
                />
              </div>
            </div>
          </p-accordionTab>
        </p-accordion>
      </div>
    </form>
  </div>

  <!-- Header tabela -->
  <div
    class="header-default responsivo-style"
    *ngIf="etpDelegadoList.length > 0"
  >
    <div class="row m-0 d-flex w-100 align-middle py-2 header-table">
      <div
        class="col-sm-12 col-md-12 col-lg-12 col-xl-12 callout text-center titulo-table-mobile"
      >
        <div class="row align-items-center">
          <!-- Texto centralizado -->
          <div class="col text-center">
            <span class="font-title">ETP's Delegados</span>
          </div>
        </div>
      </div>
    </div>
    <table
      #table
      height="90px"
      class="table table-hover table-striped table-bordered"
    >
      <caption></caption>
      <thead header>
      <th class="text-left">ID</th>
      <th class="text-left">Tipo de Delegação</th>
      <th *ngIf="!desabilitarCampos" class="text-left">
        Tipo de Contratação
      </th>
      <th class="text-center">Modificado</th>
      <th class="text-left">Descrição</th>
      <th *ngIf="!desabilitarCampos" class="text-center">Processo SEI</th>
      <th *ngIf="!desabilitarCampos" class="text-center">Número ETP</th>
      <th *ngIf="!desabilitarCampos" class="text-left">Unidade</th>
      <th class="text-left">Situação</th>
      <th class="text-center">Versão</th>
      <th class="text-left">Motivo Versionamento</th>
      <th class="text-left">Modificado</th>
      </thead>
      <tbody body>
      <ng-container *ngFor="let itemEtp of etpDelegadoList; let i = index">
        <tr
          (click)="elaborarEtp(itemEtp, false, true)"
          id="gestaoEtpDelegadoElaborarEtp"
        >
          <td class="text-left" id="gestaoEtpDelegadoId">
            {{ itemEtp.id }}
          </td>

          <td class="text-left" id="tipoPermissaoDelegacao">
            {{ itemEtp.tipoPermissaoDelegacao }}
          </td>

          <td
            *ngIf="!desabilitarCampos"
            class="text-center motivo"
            id="gestaoEtpDelegadoTipoLicDescricao"
          >
            {{ itemEtp.tipoLicitacao.descricao }}
          </td>
          <td
            class="text-left"
            title="{{ itemEtp.descricao }}"
            id="gestaoEtpDelegadoDescricao"
          >
            {{ itemEtp.descricao }}
          </td>
          <td
            *ngIf="!desabilitarCampos"
            class="text-center"
            id="gestaoEtpDelegadoProcessoSei"
          >
            {{
              itemEtp.numeroProcessoSei !== null
                ? itemEtp.numeroProcessoSei + "/" + itemEtp.anoProcessoSei
                : ""
            }}
          </td>
          <td
            *ngIf="!desabilitarCampos"
            class="text-center"
            id="gestaoEtpDelegadoEtpNumeracao"
          >
            {{
              itemEtp.etpNumeracao !== null
                ? itemEtp.etpNumeracao + "/" + itemEtp.ano
                : ""
            }}
          </td>
          <td
            *ngIf="!desabilitarCampos"
            class="text-left"
            id="gestaoEtpDelegadoSigla"
          >
            {{ itemEtp.unidadeSigla }}
          </td>
          <td class="text-left" id="gestaoEtpDelegadoUnidadeDescricao">
            {{ itemEtp.situacao.descricao }}
          </td>
          <td class="text-center" id="gestaoEtpDelegadoEtapaDescricao">
            {{ itemEtp.etpEtapa.descricao }}
          </td>
          <td class="text-center" id="gestaoEtpDelegadoVersao">=======</td>

          <td class="text-center" id="gestaoEtpDelegadoVersao">
            {{ itemEtp.versao }}
          </td>
          <td
            id="gestaoEtpDelegadoMotivoVersionamento"
            class="text-center motivo"
            title="{{ itemEtp.dsMotivoVersionamento }} {{
                itemEtp.dtVersionamento
              }} {{ itemEtp.cdUsuarioVersionamento }}"
          >
            {{ itemEtp.dsMotivoVersionamento }} {{ itemEtp.dtVersionamento }}
            {{ itemEtp.cdUsuarioVersionamento }}
          </td>
          <td class="text-left">
            {{ gestaoBase.getDataModificacao(itemEtp) }}
            {{ gestaoBase.getUsuarioModificacao(itemEtp) }}
          </td>
        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Header tabela -->
  <div class="header-default responsivo-style">
    <div class="row m-0 d-flex w-100 align-middle py-2 header-table">
      <div
        class="col-sm-12 col-md-12 col-lg-12 col-xl-12 callout text-center titulo-table-mobile"
      >
        <div class="row align-items-center">
          <!-- Texto centralizado -->
          <div class="col text-center">
            <span class="font-title">ETP's da Unidade</span>
          </div>

          <!-- Botão alinhado à direita -->
          <div class="col-auto text-end">
            <button
              noDoubleClick
              style="width: 35%; min-width: 100px"
              title="Novo"
              type="button"
              class="btn btn-success success-btn-color"
              (click)="cadastrarETP()"
            >
              <em
                class="fa fa-lg fa-plus float-center pt-1 pr-1 icons-btn"
                style="font-size: 15px"
              ></em>
              <span style="font-size: 15px">Novo</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabela -->
    <app-table-shared-etp
      [tableLazyLoadingPai]="tableLazyLoading.bind(this)"
      [onSortPai]="onSort.bind(this)"
      [gestaoBase]="gestaoBase"
      [page]="page"
      [selecionarEtp]="selecionaItem.bind(this)"
      [elaborar]="elaborarEtp.bind(this)"
      [sobreporMenuAcaoEtp]="false"
    >
    </app-table-shared-etp>
  </div>
</div>
<cadastrar-etp
  #cadastrar_etp
  (cadastrarEtp)="gravarEtp($event)"
></cadastrar-etp>
<app-versionar
  [executaVersionarGestao]="executaVersionar.bind(this)"
  #versionar_etp
></app-versionar>
<formulario-etp
  #formulario_etp
  (gravarDadosInformados)="garvarDadosFormularioEtpNext($event)"
  (fecharModalFormularioEtp)="tableLazyLoading()"
  (atualizarFormulario)="atualizarFormularioEtp($event)"
  (desbloquearEtp)="bloquearEtp($event)"
></formulario-etp>
<versoes-etp #versoes_etp (elaborarEtp)="elaborarEtp($event)"> </versoes-etp>
